# AIæ™ºèƒ½å†™ä¹¦åŠ©æ‰‹ - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

> **æ–‡æ¡£é¢å‘å¯¹è±¡**ï¼šVibeCoding AI è¾…åŠ©å¼€å‘
> **é¡¹ç›®ç±»å‹**ï¼šä¸ªäººæœ¬åœ°åŒ– Web åº”ç”¨
> **è®¾è®¡é£æ ¼**ï¼šç°ä»£ç®€çº¦å·¥ä¸šé£ (Modern Industrial Minimalist)
> **æ ¸å¿ƒä¾èµ–**ï¼šOpenRouter API (LLM), Bocha API (Web Search), OneBound API (WeChat Articles)
> **å‚è€ƒæ ‡å‡†**ï¼š`/Users/wrf/Documents/å†™ä¹¦/å†™ä½œè§„èŒƒ.md`

---

## 1. é¡¹ç›®æ¦‚è¿° (Overview)

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªè¾…åŠ©ä¸ªäººç”¨æˆ·è¿›è¡Œæ·±åº¦ä¹¦ç±å†™ä½œçš„ Web åº”ç”¨ã€‚æ ¸å¿ƒæµç¨‹åˆ†ä¸ºâ€œæ™ºèƒ½å¤§çº²ç”Ÿæˆâ€ä¸â€œæ²‰æµ¸å¼å†™ä½œâ€ä¸¤ä¸ªé˜¶æ®µã€‚ç³»ç»Ÿå¼ºè°ƒé€»è¾‘é—­ç¯ã€å¤šæºæ·±åº¦æœç´¢è¾…åŠ©ï¼ˆåŸºäºåšæŸ¥ API å…¨ç½‘æœç´¢ + OneBound API å…¬ä¼—å·æœç´¢ï¼‰ä»¥åŠä¸¥æ ¼éµå¾ªé¢„è®¾çš„å†™ä½œè§„èŒƒã€‚åº”ç”¨éœ€æ”¯æŒ VibeCoding å¿«é€Ÿå¼€å‘ï¼ŒæŠ€æœ¯æ ˆå‹å¥½ã€‚

### 1.1 æ ¸å¿ƒé…ç½®ä¸ API (Configuration)

æœ¬é¡¹ç›®ä¾èµ–ä»¥ä¸‹æ ¸å¿ƒæœåŠ¡ï¼Œå¼€å‘æ—¶éœ€æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡æˆ–æœ¬åœ° Keyï¼š

| æœåŠ¡ | ç”¨é€” | æ¥å…¥æ–‡æ¡£ | å¯†é’¥ (Example) |
| :--- | :--- | :--- | :--- |
| **OpenRouter** | æ ¸å¿ƒ LLM æ¨ç† (Thinking Models) | [Docs](https://openrouter.ai/docs/quickstart) | `sk-or-v1-e1adb4...` |
| **Bocha AI** | å…¨ç½‘æ·±åº¦æœç´¢ | [Docs](https://bocha-ai.feishu.cn/wiki/HmtOw1z6vik14Fkdu5uc9VaInBb) | `sk-9860523...` |
| **OneBound** | å¾®ä¿¡å…¬ä¼—å·æ–‡ç« æœç´¢ | [Docs](https://open.onebound.cn/help/api/weixin.item_get.html) | Key: `t3041152152`<br>Secret: `21529b37` |

### 1.2 æŠ€æœ¯æ ˆæ¨è (Tech Stack)
ä¸ºäº†å¯¹ VibeCoding å‹å¥½ä¸”é€‚åˆæœ¬åœ°è¿è¡Œï¼Œæ¨èä»¥ä¸‹æŠ€æœ¯æ ˆï¼š
- **Frontend Framework**: Next.js 14+ (App Router)
- **UI Library**: Tailwind CSS + Shadcn/UI (ç”¨äºæ„å»ºå·¥ä¸šé£ç»„ä»¶)
- **State Management**: Zustand (å¤„ç†å¤æ‚çš„åº”ç”¨çŠ¶æ€)
- **Storage**: IndexedDB (Dexie.js) æˆ– SQLite (æœ¬åœ°å­˜å‚¨ä¹¦ç±å†…å®¹ï¼Œæ— éœ€åç«¯æ•°æ®åº“)
- **AI Integration**: Vercel AI SDK (ç»Ÿä¸€å¤„ç† OpenRouter æµå¼å“åº”)
- **Markdown Rendering**: React-Markdown + Tailwind Typography

### 1.3 UI è®¾è®¡é£æ ¼ (Design Language)
- **é£æ ¼å…³é”®è¯**ï¼šå·¥ä¸šã€ç¡¬æœ—ã€é«˜å¯¹æ¯”åº¦ã€å•è‰²è°ƒã€æç®€ã€‚
- **è‰²å½©æ¿**ï¼š
  - èƒŒæ™¯ï¼šæ·±ç°/é»‘ (`#121212`)
  - å®¹å™¨ï¼šæªç°è‰² (`#1E1E1E`)
  - è¾¹æ¡†ï¼šç»†é”è¾¹æ¡† (`#333333`)
  - å¼ºè°ƒè‰²ï¼šå·¥ä¸šæ©™ (`#FF5722`) æˆ– ç»ˆç«¯ç»¿ (`#00FF41`)
- **æ’ç‰ˆ**ï¼š
  - æ ‡é¢˜ï¼šæ— è¡¬çº¿å­—ä½“ (Inter / Roboto)ï¼Œå¤§å­—å·ï¼Œç²—ä½“ã€‚
  - æ­£æ–‡ï¼šé˜…è¯»èˆ’é€‚çš„è¡¬çº¿æˆ–æ— è¡¬çº¿å­—ä½“ã€‚
  - ä»£ç /æ•°æ®/çŠ¶æ€ï¼šç­‰å®½å­—ä½“ (JetBrains Mono / Fira Code)ã€‚
- **äº¤äº’è´¨æ„Ÿ**ï¼š
  - æŒ‰é’®ï¼šç›´è§’æˆ–å¾®åœ†è§’ (2px)ï¼ŒHover äº§ç”Ÿé«˜äº®è¾¹æ¡†è€Œéé˜´å½±ã€‚
  - åŠ è½½çŠ¶æ€ï¼šä½¿ç”¨è¿›åº¦æ¡æˆ–ç»ˆç«¯é—ªçƒå…‰æ ‡ï¼Œé¿å…ä¼ ç»Ÿçš„æ—‹è½¬åœ†åœˆã€‚
  - åŠ¨ç”»ï¼šå¿«é€Ÿã€å¹²è„† (Ease-out-quint, <200ms)ã€‚

---

## 2. æ ¸å¿ƒåŠŸèƒ½æµç¨‹ (Core Features)

### 2.1 é˜¶æ®µä¸€ï¼šæ™ºèƒ½å¤§çº²ç”Ÿæˆ (Outline Generation)

æ­¤é˜¶æ®µçš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä»½å®Œå…¨ç¬¦åˆã€Šå†™ä½œè§„èŒƒã€‹çš„ç»“æ„åŒ–å¤§çº²ã€‚

#### 2.1.1 æµç¨‹é€»è¾‘ (Flow Logic)

```mermaid
graph TD
    Start[ç”¨æˆ·è¾“å…¥ç›®æ ‡ & é€‰æ‹©Thinkingæ¨¡å‹] --> Search1[æœç´¢å¾ªç¯ 1: æå–å…³é”®è¯ -> åŒå¼•æ“æœç´¢]
    Search1 --> Expand[æ¨¡å‹åŸºäºæœç´¢ç»“æœæ‹“å±•å†…å®¹]
    Expand --> Search2[æœç´¢å¾ªç¯ 2: åŸºäºæ‹“å±•å†…å®¹ç”Ÿæˆæ–°å…³é”®è¯ -> åŒå¼•æ“æœç´¢]
    Search2 --> Check1{éœ€æ±‚æ˜¯å¦æ˜ç¡®?}
    
    Check1 -- å¦ --> QA1[ç”Ÿæˆå¤šé€‰/å¡«ç©ºé¢˜ -> ç”¨æˆ·å›ç­”]
    QA1 --> Check2{åŸºäºå›ç­”å†æ¬¡åˆ¤æ–­æ˜¯å¦æ˜ç¡®?}
    Check2 -- å¦ --> QA2[ç”Ÿæˆç¬¬äºŒè½®é—®é¢˜ -> ç”¨æˆ·å›ç­”]
    Check2 -- æ˜¯ --> GenDraft
    
    Check1 -- æ˜¯ --> GenDraft[ç”Ÿæˆå¤§çº²è‰ç¨¿]
    QA2 --> GenDraft
    
    GenDraft --> Validate{ç¬¦åˆå†™ä½œè§„èŒƒ?}
    Validate -- å¦ --> AutoFix[ä¸æ”¹åŸæ„ï¼ŒæŒ‰è§„èŒƒé‡æ„æ ¼å¼]
    AutoFix --> UserReview
    Validate -- æ˜¯ --> UserReview[ç”¨æˆ·é¢„è§ˆ & ç¼–è¾‘]
    
    UserReview --> EditType{ä¿®æ”¹æ–¹å¼}
    EditType -- æ‰‹åŠ¨ --> ManualEdit[å¯Œæ–‡æœ¬/Markdownç¼–è¾‘]
    EditType -- AIè¾…åŠ© --> PromptEdit[è¾“å…¥Prompt + å‹¾é€‰å‚è€ƒçš„æœç´¢ç»“æœ]
    PromptEdit --> NewSearch{å¼•å…¥æ–°æœç´¢?}
    NewSearch -- æ˜¯ --> AddSearch[è¾“å…¥å…³é”®è¯ -> æœç´¢ -> æ·»åŠ è‡³å¼•ç”¨]
    AddSearch --> ReGen
    NewSearch -- å¦ --> ReGen[åŸºäºPrompt+é€‰å®šæœç´¢ç»“æœé‡å†™]
    ReGen --> UserReview
    
    ManualEdit --> Confirm[ç¡®è®¤å¤§çº²]
    UserReview --> Confirm
    Confirm --> EnterWriting[è¿›å…¥å†™ä½œæ¨¡å¼]
```

#### 2.1.2 è¯¦ç»†åŠŸèƒ½ç‚¹ (Detailed Requirements)

1.  **åˆå§‹åŒ–è¾“å…¥**
    *   **UI**: ç»ˆç«¯é£æ ¼å¤§è¾“å…¥æ¡†ï¼Œæ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå•ï¼ˆæ”¯æŒ OpenRouter åˆ—è¡¨ï¼Œç‰¹åˆ«æ˜¯ Thinking æ¨¡å‹ï¼‰ã€‚
    *   **Action**: ç”¨æˆ·æäº¤åï¼Œç³»ç»Ÿè¿›å…¥è‡ªåŠ¨åˆ†æçŠ¶æ€ã€‚

2.  **åŒé‡æœç´¢å¢å¼º (Two-Pass Search)**
    *   **Step 1**: `User Input` -> LLM æå–å…³é”®è¯ -> å¹¶è¡Œè°ƒç”¨ `Bocha API` (å…¨ç½‘) + `OneBound API` (å…¬ä¼—å·)ã€‚
    *   **Step 2**: `User Input` + `Search Result 1` -> LLM æ‹“å±•æ€è·¯ -> æå–æ–°å…³é”®è¯ -> å¹¶è¡Œè°ƒç”¨ `Bocha API` + `OneBound API`ã€‚
    *   **Display**: å®æ—¶æ˜¾ç¤ºæœç´¢æ—¥å¿—ï¼ˆå¦‚ï¼š`> Searching Web: "AI å†™ä½œ ç—›ç‚¹"...` / `> Searching WeChat: "AI å†™ä½œ è¡Œä¸šåˆ†æ"...`ï¼‰ï¼Œå¢å¼ºé€æ˜åº¦ã€‚

3.  **æ™ºèƒ½æ¾„æ¸…å¾ªç¯ (Clarification Loop)**
    *   **Input**: ç”¨æˆ·åˆå§‹è¾“å…¥ + 2æ¬¡æœç´¢ç»“æœã€‚
    *   **Process**: LLM åˆ¤æ–­ä¿¡æ¯æ˜¯å¦è¶³ä»¥æ”¯æ’‘ä¸€æœ¬ä¸“ä¸šä¹¦ç±çš„å¤§çº²ã€‚
    *   **Interaction**:
        *   è‹¥ä¸æ˜ç¡®ï¼Œç”Ÿæˆä¸€ç³»åˆ—é—®é¢˜ï¼ˆå¿…é¡»åŒ…å«é€‰é¡¹ï¼Œæ”¯æŒå¤šé€‰ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒç”¨æˆ·æ–‡æœ¬è¾“å…¥è¡¥å……ï¼‰ã€‚
        *   **UI**: å¡ç‰‡å¼é—®é¢˜åˆ—è¡¨ï¼Œå¤é€‰æ¡† + æ–‡æœ¬æ¡†ã€‚
        *   **é™åˆ¶**: æœ€å¤šè¿›è¡Œ 2 è½®é—®ç­”ã€‚åŸºäºæ‰€æœ‰ç´¯ç§¯ä¿¡æ¯ï¼ˆè¾“å…¥+æœç´¢+å†å²å›ç­”ï¼‰è¿›è¡Œæ¯ä¸€è½®çš„åˆ¤æ–­ã€‚

4.  **å¤§çº²ç”Ÿæˆä¸è§„èŒƒæ ¡éªŒ (Generation & Validation)**
    *   **Input Context**: ç”¨æˆ·åˆå§‹è¾“å…¥ + æ¨¡å‹çš„åˆ¤æ–­ + 2æ¬¡æœç´¢ç»“æœ + 2è½®é—®ç­”å†å² + **ç³»ç»Ÿæç¤ºè¯(åŒ…å«ã€Šå†™ä½œè§„èŒƒã€‹)**ã€‚
    *   **Validator**: ç”Ÿæˆåï¼Œä½¿ç”¨æ¨¡å‹åˆ¤æ–­å¤§çº²æ ¼å¼æ˜¯å¦å®Œå…¨ç¬¦åˆç¤ºä¾‹ã€‚
    *   **Auto-fix**: è‹¥ä¸ç¬¦åˆè§„èŒƒï¼Œ**ä¸æ”¹å˜å†…å®¹**ï¼Œä»…æŒ‰å¤§çº²ç¼–å†™è§„èŒƒè¿›è¡Œæ”¹å†™ã€‚

5.  **å¤§çº²ç¼–è¾‘å™¨ (The Outline Editor)**
    *   **UI**: å·¦ä¾§æ ‘çŠ¶å¯¼èˆªï¼Œå³ä¾§ç¼–è¾‘å™¨ã€‚
    *   **AI ä¿®æ”¹åŠŸèƒ½**:
        *   ç”¨æˆ·é€‰æ‹©æ¨¡å‹ã€‚
        *   è¾“å…¥ Prompt å¯¹å¤§çº²è¿›è¡Œä¿®æ”¹ã€‚
        *   **Context Selection**: ç”¨æˆ·å¯**æ‰‹åŠ¨å‹¾é€‰**å†å²æœç´¢ç»“æœä¸­çš„å“ªäº›æ¡ç›®ä½œä¸ºå‚è€ƒã€‚
        *   **New Search**: ç”¨æˆ·å¯è¾“å…¥å…³é”®è¯å¼•å…¥æ–°çš„æœç´¢å†…å®¹ï¼Œç³»ç»Ÿé»˜è®¤åŒæ—¶æœç´¢å…¨ç½‘å’Œå…¬ä¼—å·ï¼Œç”¨æˆ·å‹¾é€‰æ–°ç»“æœåï¼Œå†è¿›è¡Œä¿®æ”¹ç”Ÿæˆã€‚

6.  **ç¡®è®¤ä¸è·³è½¬**
    *   ç”¨æˆ·ç‚¹å‡»â€œç¡®è®¤å¤§çº²â€åï¼Œæ•°æ®é”å®šï¼Œè‡ªåŠ¨è·³è½¬è‡³å†™ä½œé¡µé¢ã€‚

---

### 2.2 é˜¶æ®µäºŒï¼šæ²‰æµ¸å¼å†™ä½œ (Book Writing)

#### 2.2.1 ç•Œé¢å¸ƒå±€ (UI Layout)
*   **å·¦ä¾§æ  (Sidebar)**: ç« èŠ‚å¯¼èˆªæ ‘ã€‚
    *   çŠ¶æ€æ ‡è®°ï¼šâšª Pending, ğŸŸ¡ Generating, ğŸŸ¢ Completedã€‚
    *   **äº¤äº’é™åˆ¶**: å¿…é¡»æŒ‰é¡ºåºç”Ÿæˆã€‚åªæœ‰ä¸Šä¸€ç« ï¼ˆæˆ–ä¸Šä¸€èŠ‚ï¼‰å®Œæˆåï¼Œä¸‹ä¸€ç« ï¼ˆæˆ–ä¸‹ä¸€èŠ‚ï¼‰æ‰è§£é”ã€‚
*   **ä¸»åŒºåŸŸ (Main)**:
    *   é¡¶éƒ¨ï¼šå½“å‰ç« èŠ‚/å°èŠ‚æ ‡é¢˜åŠå¤§çº²æ‘˜è¦ã€‚
    *   æ“ä½œåŒºï¼š
        *   **Prompt è¾“å…¥æ¡†**: ç”¨æˆ·å¯è¾“å…¥å…·ä½“æŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰ã€‚
        *   **Model é€‰æ‹©**: å…è®¸ä¸ºæ¯ä¸€ç« é€‰æ‹©ä¸åŒçš„æ¨¡å‹ã€‚
        *   **Action**: "å¼€å§‹ç”Ÿæˆ / Start Generation" æŒ‰é’®ã€‚
    *   ç¼–è¾‘å™¨ï¼šMarkdown å®æ—¶æµå¼è¾“å‡ºåŒºåŸŸã€‚
*   **å³ä¾§æ  (Reference)**:
    *   æ˜¾ç¤ºå½“å‰å¼•ç”¨çš„æœç´¢èµ„æ–™ã€‚
    *   ã€Šå†™ä½œè§„èŒƒã€‹æ‘˜è¦å¡ç‰‡ã€‚

#### 2.2.2 ç”Ÿæˆé€»è¾‘ (Generation Logic)

1.  **è§¦å‘æœºåˆ¶ (Trigger)**
    *   ç”¨æˆ·ç‚¹å‡»æŸç« ï¼ˆChapterï¼‰ã€‚å»ºè®® UI æ”¯æŒå±•å¼€è‡³â€œèŠ‚â€ï¼ˆSectionï¼‰ç²’åº¦ï¼Œå…è®¸ç”¨æˆ·æŒ‰â€œèŠ‚â€ç”Ÿæˆï¼Œæˆ–ç‚¹å‡»â€œç« â€è¿›è¡Œæ‰¹é‡ç”Ÿæˆã€‚
    *   ç”¨æˆ·è¾“å…¥ Promptï¼ˆå¯é€‰ï¼‰+ é€‰æ‹©æ¨¡å‹ -> ç‚¹å‡»ç”Ÿæˆã€‚

2.  **Section-Level Search & Writing (å°ç« èŠ‚ç²’åº¦æ§åˆ¶)**
    *   å³ä¾¿ç”¨æˆ·ç‚¹å‡»çš„æ˜¯â€œç”Ÿæˆå…¨ç« â€ï¼Œç³»ç»Ÿå†…éƒ¨ä¹Ÿéœ€æŒ‰â€œèŠ‚â€è¿›è¡Œè¿­ä»£ï¼š
    *   **Step A (Search Check)**: å¯¹äºæ¯ä¸€ä¸ªâ€œå°ç« èŠ‚â€ï¼ˆSectionï¼‰ï¼Œæ¨¡å‹è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦å¼•å…¥å¤–éƒ¨äº‹å®æ•°æ®ã€‚
        *   *Prompt*: "Based on section title 'XXX', do we need external data?"
    *   **Step B (Auto-Search)**: è‹¥éœ€è¦ï¼Œè‡ªåŠ¨ç”Ÿæˆå…³é”®è¯ -> è°ƒç”¨ Bocha API (Web) + OneBound API (WeChat) -> èšåˆç»“æœã€‚
    *   **Step C (Generation)**:
        *   **Input**:
            1.  ã€Šå†™ä½œè§„èŒƒ.mdã€‹ï¼ˆSystem Promptï¼‰ã€‚
            2.  å½“å‰ç« èŠ‚å¤§çº²ã€‚
            3.  **ç”¨æˆ· Prompt**ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚
            4.  **æœç´¢ç»“æœ**ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚
            5.  **å‰æ–‡ä¸Šä¸‹æ–‡**ï¼ˆPrevious Contextï¼‰ï¼š**å¿…é¡»**åŒ…å«ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰ç« èŠ‚å†…å®¹ï¼Œä»¥ä¿è¯è¿è´¯æ€§ã€‚
        *   **Output**: ç”Ÿæˆè¯¥å°èŠ‚çš„ Markdown å†…å®¹ã€‚

3.  **ä¸Šä¸‹æ–‡ç®¡ç† (Context Management)**
    *   é‰´äºä¹¦ç±å¯èƒ½å¾ˆé•¿ï¼Œéœ€å®ç°â€œå…³é”®ä¸Šä¸‹æ–‡â€æœºåˆ¶ï¼š
    *   **Recent History**: æœ€è¿‘ N ç« çš„å®Œæ•´æ–‡æœ¬ã€‚
    *   **Global Summary**: è¾ƒè¿œç« èŠ‚çš„æ‘˜è¦ï¼ˆæˆ–ä¾èµ–é•¿ Context æ¨¡å‹ç›´æ¥é€ä¼ å…¨æ–‡ï¼Œè§† token é™åˆ¶è€Œå®šï¼‰ã€‚
    *   **Prompt æ³¨å…¥**: å§‹ç»ˆåœ¨ System Prompt ä¸­å¼ºè°ƒâ€œæ‰¿ä¸Šå¯ä¸‹â€ï¼Œå¼•ç”¨å‰æ–‡è§‚ç‚¹ã€‚

4.  **è§„èŒƒæ‰§è¡Œ**
    *   ä¸¥æ ¼éµå¾ªã€Šå†™ä½œè§„èŒƒã€‹ä¸­çš„å›¾è¡¨ç¼–å·ï¼ˆå›¾ x-yï¼‰ã€æ¨¡å—ç±»å‹ï¼ˆç†è®º/æ–¹æ³•/å®æˆ˜/å‰æ²¿ï¼‰å†™ä½œè¦æ±‚ã€‚

---

## 3. äº¤äº’è·³è½¬é€»è¾‘ (Interaction Logic)

### 3.1 é¡µé¢è·¯ç”±
- `/`: é¦–é¡µ/Dashboard (æ–°å»ºä¹¦ç±æˆ–ç»§ç»­)
- `/wizard`: å¤§çº²ç”Ÿæˆå‘å¯¼ (Step-by-step)
- `/editor/[book_id]`: æ ¸å¿ƒå†™ä½œç•Œé¢

### 3.2 çŠ¶æ€æµè½¬
1.  **Init**: ç”¨æˆ·è¾“å…¥ -> `/wizard`
2.  **Wizard Loop**: Search -> QA -> Search -> QA -> Outline Preview
3.  **Refinement**: Outline Edit (Manual/AI) -> Confirm -> Redirect to `/editor`
4.  **Writing**:
    - Select Chapter 1 -> Generate -> Review/Edit -> Lock
    - Unlock Chapter 2 -> Select -> Generate...
    - (Loop until Finish)
5.  **Export**: å¯¼å‡ºå®Œæ•´ Markdown/PDFã€‚

---

## 4. æç¤ºè¯å·¥ç¨‹ç­–ç•¥ (Prompt Engineering)

### 4.1 å…³é”®è¯æå– (System Prompt)
```text
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä¹¦ç±ç­–åˆ’ä¸“å®¶ã€‚è¯·åˆ†æç”¨æˆ·çš„å†™ä½œç›®æ ‡ï¼Œæå–3-5ä¸ªæ ¸å¿ƒæœç´¢å…³é”®è¯ï¼Œç”¨äºåœ¨æœç´¢å¼•æ“ï¼ˆå…¨ç½‘ + å…¬ä¼—å·æ–‡ç« ï¼‰ä¸­å¯»æ‰¾ç›¸å…³çš„å¸‚åœºç°çŠ¶ã€ç—›ç‚¹ã€æ¡ˆä¾‹æˆ–ç†è®ºæ”¯æŒã€‚
è¾“å‡ºæ ¼å¼ï¼šJSONæ•°ç»„ ["keyword1", "keyword2", ...]
```

### 4.2 éœ€æ±‚æ¾„æ¸…æé—® (System Prompt)
```text
ä½ æ˜¯ä¸€ä¸ªä¸¥è°¨çš„å›¾ä¹¦ç¼–è¾‘ã€‚åŸºäºç”¨æˆ·ç›®æ ‡å’Œæœç´¢ç»“æœï¼Œåˆ¤æ–­å½“å‰ä¿¡æ¯æ˜¯å¦è¶³ä»¥æ„å»ºä¸€ä»½æ·±åº¦çš„å¤§çº²ã€‚
å¦‚æœä¸è¶³ï¼Œè¯·æå‡º3-5ä¸ªå…³é”®é—®é¢˜æ¥æ˜ç¡®ä¹¦ç±çš„å—ä¼—ã€æ ¸å¿ƒå·®å¼‚åŒ–ä»·å€¼æˆ–å…·ä½“é£æ ¼ã€‚
è¦æ±‚ï¼š
1. é—®é¢˜è¦æœ‰é’ˆå¯¹æ€§ã€‚
2. æ¯ä¸ªé—®é¢˜å¿…é¡»æä¾›3-4ä¸ªå»ºè®®é€‰é¡¹ï¼ˆä¾›ç”¨æˆ·å¤šé€‰ï¼‰ã€‚
3. å…è®¸ç”¨æˆ·è¡¥å……å›ç­”ã€‚
è¾“å‡ºæ ¼å¼ï¼šJSONå¯¹è±¡ { "sufficient": boolean, "questions": [{ "text": string, "options": string[] }] }
```

### 4.3 å¤§çº²ç”Ÿæˆ (System Prompt)
```text
ä½ æ˜¯ä¸€ä¸ªèµ„æ·±å›¾ä¹¦å‡ºç‰ˆäººã€‚è¯·æ ¹æ®ä»¥ä¸‹æ‰€æœ‰ä¿¡æ¯ç”Ÿæˆä¸€ä»½æ·±åº¦ä¸“è‘—å¤§çº²ã€‚

ã€è¾“å…¥ä¿¡æ¯ã€‘ï¼š
1. ç”¨æˆ·æ ¸å¿ƒç›®æ ‡: {{user_goal}}
2. ç´¯ç§¯æœç´¢èµ„æ–™: {{search_data_summary}}
3. ç”¨æˆ·é—®ç­”è®°å½•: {{qa_history}}

ã€å¿…é¡»ä¸¥æ ¼éµå®ˆçš„å†™ä½œè§„èŒƒã€‘ï¼š
{{writing_standards_content}} (æ­¤å¤„æ³¨å…¥å†™ä½œè§„èŒƒ.mdå…¨æ–‡)

ã€è¦æ±‚ã€‘ï¼š
- ä¸¥æ ¼é‡‡ç”¨â€œç¯‡-ç« -èŠ‚â€ä¸‰çº§æ¶æ„ã€‚
- æ¯ä¸€èŠ‚å¿…é¡»æ ‡æ³¨å…¶ç±»å‹ï¼ˆç†è®ºå‹/æ–¹æ³•å‹/å®æˆ˜å‹/å‰æ²¿å‹ï¼‰ã€‚
- æ¯ä¸€ç« å¿…é¡»åŒ…å«â€œç« å¼•è¨€â€å’Œâ€œæœ¬ç« å°ç»“â€ã€‚
- ç¡®ä¿é€»è¾‘é—­ç¯ï¼Œæ‹’ç»ç®€å•çš„çŸ¥è¯†ç‚¹å †ç Œã€‚
```

### 4.4 å†™ä½œå†…å®¹ç”Ÿæˆ (System Prompt)
```text
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šä½œå®¶ã€‚æ­£åœ¨ç¼–å†™ã€Š{{book_title}}ã€‹çš„ï¼š
ç¬¬ {{part_index}} ç¯‡ - ç¬¬ {{chapter_index}} ç«  - ç¬¬ {{section_index}} èŠ‚ï¼š{{section_title}}

ã€å†™ä½œè§„èŒƒã€‘ï¼š
{{writing_standards_content}}

ã€å‰æ–‡è„‰ç»œï¼ˆç”¨äºä¿æŒè¿è´¯æ€§ï¼‰ã€‘ï¼š
{{previous_context}}

ã€æœ¬èŠ‚å‚è€ƒèµ„æ–™ã€‘ï¼š
{{search_results}}

ã€ç”¨æˆ·æŒ‡ä»¤ã€‘ï¼š
{{user_prompt}}

ã€ä»»åŠ¡ã€‘ï¼š
è¯·æ’°å†™æœ¬èŠ‚å†…å®¹ã€‚
1. é£æ ¼ï¼šä¸“ä¸šã€å¹²è´§ã€ç°ä»£å·¥ä¸šé£ã€‚
2. ç»“æ„ï¼šä¸¥æ ¼æŒ‰ç…§ã€Šå†™ä½œè§„èŒƒã€‹ä¸­å®šä¹‰çš„â€œ{{section_type}}â€ç±»å‹çš„æ¨¡æ¿è¿›è¡Œå†™ä½œã€‚
3. å¼•ç”¨ï¼šå¦‚æœä½¿ç”¨äº†å‚è€ƒèµ„æ–™ï¼Œè¯·è‡ªç„¶èå…¥ï¼Œä¸è¦ç”Ÿç¡¬å †ç Œã€‚
4. ç¯‡å¹…ï¼šé€‚ä¸­ï¼Œç¡®ä¿æŠŠé—®é¢˜è®²é€ã€‚
```

---

## 5. æ•°æ®ç»“æ„å®šä¹‰ (Data Schemas)

```typescript
// ä¹¦ç±å¤§çº²ç»“æ„
interface BookOutline {
  title: string;
  target_audience: string;
  core_goal: string;
  parts: BookPart[]; // ç¯‡
}

interface BookPart {
  id: string;
  title: string; // ç¯‡æ ‡é¢˜
  intro: string; // ç¯‡é¦–è¯­
  chapters: BookChapter[];
}

interface BookChapter {
  id: string;
  title: string;
  intro: string; // ç« å¼•è¨€
  summary: string; // æœ¬ç« å°ç»“
  sections: BookSection[]; // èŠ‚
  status: 'locked' | 'pending' | 'generating' | 'completed';
}

interface BookSection {
  id: string;
  title: string;
  type: 'theory' | 'method' | 'practice' | 'trend'; // å¯¹åº”è§„èŒƒä¸­çš„ A/B/C/D ç±»å‹
  key_points: string[];
  content?: string; // ç”Ÿæˆçš„æ­£æ–‡
  search_keywords?: string[]; // è‡ªåŠ¨ç”Ÿæˆçš„æœç´¢è¯
  search_references?: SearchResult[]; // å®é™…å¼•ç”¨çš„æœç´¢ç»“æœ
}

// æœç´¢ç»“æœ
interface SearchResult {
  title: string;
  url: string;
  snippet: string;
  source: 'web' | 'wechat'; // åŒºåˆ†æ¥æºï¼šå…¨ç½‘ or å…¬ä¼—å·
  publish_date?: string;
}

// ç”¨æˆ·äº¤äº’çŠ¶æ€
interface WizardState {
  step: 'input' | 'search_1' | 'expand' | 'search_2' | 'clarify' | 'outline' | 'review';
  clarification_round: number; // 0, 1, 2
  history: {
    user_input: string;
    search_contexts: SearchContext[]; // åŒ…å« query å’Œ results
    qa_pairs: { question: string; options: string[]; answer: string[] | string }[]; // æ”¯æŒå¤šé€‰
  };
}

---

## 6. å¼€å‘è®¡åˆ’ (Development Plan)

1.  **Setup**: åˆå§‹åŒ– Next.js é¡¹ç›®ï¼Œé…ç½® Tailwind åŠ Shadcn/UIï¼Œè®¾ç½® API ä»£ç† (OpenRouter/Bocha/OneBound)ã€‚
2.  **Core Logic (Hook)**: å®ç° `useBookGenerator` Hookï¼Œå°è£…çŠ¶æ€æœºå’Œ API è°ƒç”¨é“¾ï¼ˆæ”¯æŒåŒæºæœç´¢èšåˆï¼‰ã€‚
```
